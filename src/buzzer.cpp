#include "buzzer.hpp"
#include <Arduino.h>
#include "utils/pitches.hpp"
#include "utils/constants.hpp"

Buzzer::Buzzer()
{
    this->pin = BUZZER_PIN;
    this->frequency = 1000;
    this->lastUpdate = 0;
    this->note = 0;
}

void Buzzer::buzz()
{
    pinMode(this->pin, OUTPUT);

    this->play(this->frequency, 5);
    this->frequency = (this->frequency + 100) % 10000;
}

void Buzzer::stop()
{
    digitalWrite(this->pin, LOW);
}

void Buzzer::play(int frequency, int duration)
{
    tone(this->pin, frequency, duration);
}

void Buzzer::playNyanCat()
{
    static int melody[] = {
        NOTE_DS5,
        NOTE_E5,
        NOTE_FS5,
        0,
        NOTE_B5,
        NOTE_E5,
        NOTE_DS5,
        NOTE_E5,
        NOTE_FS5,
        NOTE_B5,
        NOTE_DS6,
        NOTE_E6,
        NOTE_DS6,
        NOTE_AS5,
        NOTE_B5,
        0,
        NOTE_FS5,
        0,
        NOTE_DS5,
        NOTE_E5,
        NOTE_FS5,
        0,
        NOTE_B5,
        NOTE_CS6,
        NOTE_AS5,
        NOTE_B5,
        NOTE_CS6,
        NOTE_E6,
        NOTE_DS6,
        NOTE_E6,
        NOTE_CS6,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_D4,
        NOTE_DS4,
        NOTE_FS2,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_D4,
        NOTE_DS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_D4,
        NOTE_DS4,
        NOTE_FS2,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_D4,
        NOTE_DS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_E3,
        NOTE_DS3,
        NOTE_E3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_AS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_AS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_E3,
        NOTE_DS3,
        NOTE_E3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_AS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_D4,
        NOTE_DS4,
        NOTE_FS2,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_D4,
        NOTE_DS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_D4,
        NOTE_DS4,
        NOTE_FS2,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_GS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_D4,
        NOTE_DS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_D4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_FS4,
        NOTE_CS4,
        NOTE_D4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_CS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_E3,
        NOTE_DS3,
        NOTE_E3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_AS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_AS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_CS4,
        NOTE_B3,
        NOTE_E3,
        NOTE_DS3,
        NOTE_E3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_CS4,
        NOTE_DS4,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_FS3,
        NOTE_B3,
        NOTE_B3,
        NOTE_AS3,
        NOTE_B3,
        NOTE_FS3,
        NOTE_GS3,
        NOTE_B3,
        NOTE_E4,
        NOTE_DS4,
        NOTE_E4,
        NOTE_FS4,
        NOTE_B3,
        NOTE_CS4,
    };

    static int noteDurations[] = {
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        16,
        8,
        8,
    };

    if (this->lastUpdate - millis() >= noteDurations[this->note])
    {
        int noteDuration = 1000 / noteDurations[this->note];
        tone(this->pin, melody[this->note], noteDuration);

        int pauseBetweenNotes = noteDuration * 1.30;
        this->note = (note + 1) % sizeof(melody) / sizeof(melody[0]);
        noTone(8);
        this->lastUpdate = millis();
    }
}